<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - AquaSphere</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Shared Navbar CSS -->
    <link rel="stylesheet" href="navbar.css">
    
    <!-- Preload navbar HTML for faster loading -->
    <link rel="preload" href="navbar.html" as="document">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif !important;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            overflow-x: hidden;
            padding-top: 70px;
        }
        
        /* Main Content */
        .main-content {
            padding: 1.5rem 0;
            min-height: calc(100vh - 70px - 200px);
        }
        
        /* Containers Wrapper - Side by Side Layout */
        .containers-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        @media (max-width: 991px) {
            .containers-wrapper {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }
        
        .profile-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f0f9ff 100%);
            border-radius: 28px;
            width: 100%;
            overflow: hidden;
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .profile-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #0ea5e9, #0284c7, #06b6d4, #0891b2, #0ea5e9);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
            z-index: 1;
        }
        
        @keyframes gradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }
        
        .profile-header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 50%, #06b6d4 100%);
            padding: 1.25rem 1.5rem 1rem;
            border-bottom: none;
            border-radius: 28px 28px 0 0;
            position: relative;
            overflow: hidden;
        }
        
        .profile-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            animation: rotateGradient 15s linear infinite;
        }
        
        @keyframes rotateGradient {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .profile-header h2 {
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            margin: 0;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .profile-header h2::before {
            content: 'üë§';
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2)) brightness(0) invert(1);
            animation: iconFloat 3s ease-in-out infinite;
        }
        
        @keyframes iconFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        
        .profile-body {
            background: transparent;
            padding: 1.25rem 1.5rem 1rem;
            position: relative;
            z-index: 1;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .form-group {
            margin-bottom: 0.5rem;
            position: relative;
        }
        
        .form-group.error input,
        .form-group.error select {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .form-group input.success,
        .form-group select.success {
            border-color: #0ea5e9;
            background: #f0f9ff;
            box-shadow: 0 0 0 0.2rem rgba(14, 165, 233, 0.25);
        }
        
        .form-group.error input:focus,
        .form-group.error select:focus {
            border-color: #ef4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.12), 0 4px 12px rgba(239, 68, 68, 0.15);
        }
        
        .profile-section {
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        
        .profile-section:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .profile-section h5 {
            margin-bottom: 0.75rem !important;
            font-size: 1rem !important;
        }
        
        #updateProfileBtn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #94a3b8 !important;
        }
        
        #updateProfileBtn:disabled:hover {
            background: #94a3b8 !important;
            transform: none;
        }
        
        .form-group .error-message {
            display: none;
            margin-top: 0.4rem;
            padding: 0.5rem 0.75rem;
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border: 1px solid #fca5a5;
            border-radius: 8px;
            color: #991b1b;
            font-size: 0.85rem;
            font-weight: 500;
            position: relative;
            animation: errorSlideIn 0.3s ease;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.15);
        }
        
        .form-group.error .error-message {
            display: block;
        }
        
        .form-group .error-message::before {
            content: '‚ö†Ô∏è';
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }
        
        @keyframes errorSlideIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #0f172a;
            font-size: 0.9rem;
            letter-spacing: 0.01em;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.12), 0 4px 12px rgba(14, 165, 233, 0.15);
            background: linear-gradient(to bottom, #ffffff, #f8faff);
            transform: translateY(-1px);
        }
        
        .form-group.error input:focus,
        .form-group.error select:focus {
            border-color: #ef4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.12), 0 4px 12px rgba(239, 68, 68, 0.15);
        }
        
        .form-group input:hover,
        .form-group select:hover {
            border-color: #cbd5e1;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .form-group.error input:hover,
        .form-group.error select:hover {
            border-color: #f87171;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23475569' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }
        
        .profile-footer {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            border-top: 2px solid #f1f5f9;
            background: linear-gradient(to bottom, #ffffff, #f8fafc);
            border-radius: 0 0 28px 28px;
            position: relative;
            z-index: 1;
        }
        
        .btn-cancel {
            padding: 12px 28px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #64748b;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-cancel:hover {
            border-color: #cbd5e1;
            background: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            color: #64748b;
            text-decoration: none;
        }
        
        .btn-submit {
            padding: 12px 28px;
            border: none;
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.35);
        }
        
        .btn-submit:hover {
            background: linear-gradient(135deg, #0284c7, #0369a1);
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(14, 165, 233, 0.45);
        }
        
        .btn-submit:active {
            transform: translateY(0);
        }
        
        /* Footer Styles */
        .footer {
            background: #0369a1;
            color: white;
            padding: 20px 0 15px;
            margin-top: 40px;
            width: 100%;
        }
        
        .footer-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.7rem;
        }
        
        .footer-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            display: block;
            margin-bottom: 0.3rem;
        }
        
        .footer-link:hover {
            color: white;
            transform: translateX(5px);
        }
        
        .social-icons a {
            display: inline-block;
            width: 35px;
            height: 35px;
            line-height: 35px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 50%;
            margin-right: 10px;
            transition: all 0.3s ease;
        }
        
        .social-icons a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .footer p {
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        /* Password Change Success Modal */
        .password-change-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeInModal 0.4s ease;
        }
        
        .password-change-modal.active {
            display: flex;
        }
        
        @keyframes fadeInModal {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .password-change-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f0f9ff 100%);
            border-radius: 28px;
            width: 90%;
            max-width: 500px;
            padding: 3rem 2.5rem;
            text-align: center;
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            animation: passwordModalSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes passwordModalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .password-change-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #0ea5e9, #0284c7, #06b6d4, #0891b2, #0ea5e9);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }
        
        .password-change-content::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(14, 165, 233, 0.08) 0%, transparent 70%);
            animation: rotateGradient 20s linear infinite;
            pointer-events: none;
        }
        
        .password-change-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.4);
            animation: iconPulse 2s ease-in-out infinite;
        }
        
        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 10px 30px rgba(14, 165, 233, 0.4);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 15px 40px rgba(14, 165, 233, 0.6);
            }
        }
        
        .password-change-icon i {
            font-size: 2.5rem;
            color: white;
            animation: iconBounce 1.5s ease-in-out infinite;
        }
        
        @keyframes iconBounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        
        .password-change-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0369a1;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        
        .password-change-content p {
            font-size: 1rem;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .password-change-loader {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            position: relative;
            z-index: 1;
        }
        
        .password-change-loader .loader-dot {
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border-radius: 50%;
            animation: loaderDot 1.4s ease-in-out infinite;
        }
        
        .password-change-loader .loader-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .password-change-loader .loader-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .password-change-loader .loader-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes loaderDot {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1.2);
                opacity: 1;
            }
        }
        
        /* Settings Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(12px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeInModal 0.3s ease;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .address-modal {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f0f9ff 100%);
            border-radius: 28px;
            width: 100%;
            max-width: 600px;
            max-height: 92vh;
            overflow: hidden;
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
            animation: addressModalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        @keyframes addressModalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(30px) rotateX(10deg);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0) rotateX(0deg);
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 50%, #06b6d4 100%);
            padding: 2rem 2rem 1.5rem;
            border-bottom: none;
            border-radius: 28px 28px 0 0;
            position: relative;
            overflow: hidden;
        }
        
        .modal-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            animation: rotateGradient 15s linear infinite;
        }
        
        .modal-header h2 {
            font-size: 1.75rem;
            font-weight: 800;
            color: white;
            margin: 0;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .modal-body {
            background: transparent;
            flex: 1;
            overflow-y: auto;
            padding: 2rem 2rem 1.5rem;
            max-height: calc(92vh - 250px);
            position: relative;
            z-index: 1;
        }
        
        /* Logout Confirmation Modal */
        .logout-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeInModal 0.3s ease;
        }
        
        .logout-confirm-modal.active {
            display: flex;
        }
        
        .logout-confirm-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 24px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
            max-width: 420px;
            width: 90%;
            position: relative;
            overflow: hidden;
            animation: modalScaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: center;
        }
        
        @keyframes modalScaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .logout-confirm-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0ea5e9 0%, #0284c7 50%, #0369a1 100%);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }
        
        .logout-confirm-icon-wrapper {
            display: flex;
            justify-content: center;
            padding: 2rem 2rem 1rem;
            position: relative;
        }
        
        .logout-confirm-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(14, 165, 233, 0.3);
            position: relative;
            animation: iconFloat 2s ease-in-out infinite;
        }
        
        .logout-confirm-icon::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            opacity: 0.2;
            animation: iconPulseBlue 2s ease-in-out infinite;
        }
        
        .logout-confirm-icon i {
            font-size: 2.5rem;
            color: #0ea5e9;
            position: relative;
            z-index: 1;
            animation: iconBounce 0.6s ease;
        }
        
        .logout-confirm-body {
            padding: 1rem 2rem 1.5rem;
            text-align: center;
        }
        
        .logout-confirm-body h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }
        
        .logout-confirm-body p {
            font-size: 1rem;
            color: #64748b;
            line-height: 1.6;
            margin: 0;
        }
        
        .logout-confirm-footer {
            display: flex;
            gap: 1rem;
            padding: 1.5rem 2rem 2rem;
            justify-content: center;
        }
        
        .btn-logout-cancel,
        .btn-logout-confirm {
            padding: 12px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            outline: none;
            min-width: 120px;
        }
        
        .btn-logout-cancel {
            background: #f1f5f9;
            color: #475569;
            border: 2px solid #e2e8f0;
        }
        
        .btn-logout-cancel:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .btn-logout-confirm {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.4);
        }
        
        .btn-logout-confirm:hover {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.5);
        }
        
        .btn-logout-confirm:active {
            transform: translateY(0);
        }
        
        @keyframes iconPulseBlue {
            0%, 100% {
                opacity: 0.2;
                transform: scale(1);
            }
            50% {
                opacity: 0.3;
                transform: scale(1.05);
            }
        }
        
        /* Override Bootstrap success alert colors to blue */
        .alert-success {
            background-color: #dbeafe !important;
            border-color: #0ea5e9 !important;
            color: #0369a1 !important;
        }
        
        .alert-success i {
            color: #0ea5e9 !important;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .profile-body {
                padding: 1.5rem 1.5rem 1rem;
            }
            
            .profile-header {
                padding: 1.5rem 1.5rem 1rem;
            }
            
            .profile-footer {
                padding: 1rem 1.5rem;
                flex-direction: column;
            }
            
            .btn-cancel,
            .btn-submit {
                width: 100%;
            }
            
            .password-change-content {
                padding: 2rem 1.5rem;
                max-width: 90%;
            }
            
            .password-change-content h3 {
                font-size: 1.25rem;
            }
            
            .password-change-content p {
                font-size: 0.9rem;
            }
        }
        
        /* Cart Summary Style for Address Container */
        .cart-summary {
            background: white;
            border-radius: 28px;
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.1);
            padding: 1rem;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .cart-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #0ea5e9, #0284c7, #06b6d4, #0891b2, #0ea5e9);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
            z-index: 1;
        }
        
        /* Delivery Address Section */
        .delivery-address-section {
            padding: 0;
        }
        
        .address-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #f1f5f9;
            margin-bottom: 1rem;
        }
        
        .address-header i {
            color: #ef4444;
            font-size: 1.1rem;
        }
        
        .address-header span {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ef4444;
        }
        
        .address-content {
            min-height: 60px;
        }
        
        .empty-address {
            text-align: center;
            padding: 1.5rem;
            color: #94a3b8;
        }
        
        .empty-address p {
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }
        
        .btn-add-address {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-add-address:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
            color: white;
        }
        
        .address-display {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .address-display:hover {
            border-color: #0ea5e9;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.1);
        }
        
        .address-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            gap: 1rem;
        }
        
        .address-info {
            flex: 1;
        }
        
        .address-name-phone {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0369a1;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .address-name-phone strong {
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .address-name-phone span {
            color: #64748b;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .address-text {
            color: #475569;
            line-height: 1.6;
            font-size: 0.9rem;
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            border-left: 3px solid #0ea5e9;
            margin-top: 0;
        }
        
        .address-tabs {
            display: flex;
            gap: 0.25rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .address-tab {
            background: transparent;
            border: none;
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .address-tab:hover {
            color: #0ea5e9;
            background: rgba(14, 165, 233, 0.05);
        }
        
        .address-tab.active {
            color: #0ea5e9;
            border-bottom-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.05);
        }
        
        .address-tab i {
            font-size: 0.75rem;
        }
        
        .address-tab-content-wrapper {
            min-height: 60px;
        }
        
        .address-tab-content {
            display: none;
        }
        
        .address-tab-content.active {
            display: block;
        }
        
        .address-location-section {
            padding: 0;
        }
        
        .address-coordinates {
            background: white;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border: 1px solid #e2e8f0;
        }
        
        .coordinates-label {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }
        
        .coordinates-label i {
            color: #0ea5e9;
            font-size: 0.8rem;
        }
        
        .coordinates-display {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .coordinate-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .coordinate-label {
            font-weight: 600;
            color: #64748b;
            font-size: 0.85rem;
        }
        
        .coordinate-value {
            font-family: 'Courier New', monospace;
            color: #0369a1;
            font-weight: 600;
            font-size: 0.85rem;
            background: #f0f9ff;
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        .address-map-container {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 0.5rem;
            position: relative;
        }
        
        .address-map-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            border-radius: 0;
            border: none;
            margin: 0;
        }
        
        .address-map-fullscreen-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: white;
            border: 2px solid #e2e8f0;
            color: #475569;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 1000;
        }
        
        .address-map-fullscreen-btn:hover {
            background: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }
        
        .address-map {
            width: 100%;
            height: 100%;
        }
        
        .address-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.75rem;
            flex-shrink: 0;
        }
        
        .badge-default {
            background: linear-gradient(135deg, #fff7ed, #ffedd5);
            color: #ea580c;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            border: 1px solid #fed7aa;
            box-shadow: 0 2px 4px rgba(234, 88, 12, 0.1);
        }
        
        .address-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-change-address {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-change-address:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
            color: white;
        }
        
        .btn-delete-address {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-delete-address:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
            color: white;
        }
        
        /* Address Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .address-modal {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f0f9ff 100%);
            border-radius: 24px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 100px rgba(0, 0, 0, 0.4);
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .address-modal .modal-header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 50%, #06b6d4 100%);
            padding: 1.5rem 2rem;
            border-radius: 24px 24px 0 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        
        .address-modal .modal-header h2 {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            flex: 1;
        }
        
        .address-modal .modal-header i {
            color: #ef4444;
            font-size: 1.5rem;
        }
        
        .address-modal .modal-body {
            padding: 2rem;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            flex: 1;
            margin-bottom: 1rem;
        }
        
        .form-group.full-width {
            width: 100%;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 0.2rem rgba(14, 165, 233, 0.25);
        }
        
        .form-group .error-message {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .label-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .label-section span {
            font-weight: 600;
            color: #475569;
            font-size: 0.85rem;
        }
        
        .label-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .label-btn {
            padding: 12px 28px;
            border: 2px solid #e2e8f0;
            background: white;
            color: #94a3b8;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        
        .label-btn.active {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            border-color: #0ea5e9;
        }
        
        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 2px solid #f1f5f9;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn-cancel {
            background: white;
            border: 2px solid #e2e8f0;
            color: #64748b;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .btn-cancel:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            color: #475569;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
            color: white;
        }
        
        .map-placeholder {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px dashed #0ea5e9;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn-add-location {
            background: linear-gradient(135deg, #ffffff, #f8faff);
            border: 2px solid #0ea5e9;
            color: #0ea5e9;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1;
            position: relative;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.2);
        }
        
        .btn-add-location:hover {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.35);
        }
        
        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.75rem;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .map-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;
            border-radius: 0;
            border: none;
        }
        
        .map-container #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 8px;
        }
        
        .btn-map-control {
            background: white;
            border: 2px solid #e2e8f0;
            color: #475569;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn-map-control:hover {
            background: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }
        
        .map-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1001;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            font-weight: 600;
            color: #0ea5e9;
        }
        
        .map-loading i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Leaflet custom styles */
        .leaflet-container {
            font-family: 'Poppins', sans-serif;
        }
        
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .leaflet-popup-content {
            margin: 12px 16px;
            font-weight: 600;
            color: #0369a1;
        }
    </style>
</head>
<body>
    <!-- Navbar Container -->
    <div id="navbar-container"></div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <div class="containers-wrapper">
                <!-- Profile Container -->
                <div class="profile-container">
                    <div class="profile-header">
                        <h2>Profile</h2>
                    </div>
                    <div class="profile-body">
                        <form id="profileForm" onsubmit="saveProfile(event)" novalidate>
                        <div class="profile-section">
                            <h5 style="color: #0369a1; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Account Information</h5>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profileUsername">Username</label>
                                    <input type="text" id="profileUsername" name="username" placeholder="Choose a username" autocomplete="off" readonly style="background: #f8f9fa; cursor: not-allowed;">
                                    <small style="color: #64748b; font-size: 0.85rem;">Username cannot be changed</small>
                                </div>
                                <div class="form-group">
                                    <label for="profileEmail">Email</label>
                                    <input type="email" id="profileEmail" name="email" placeholder="Enter your email" autocomplete="off" required>
                                    <div class="error-message" id="profileEmail-error" style="display: none;">Email is required.</div>
                                    <div class="error-message" id="profileEmail-format-error" style="display: none;">Please enter a valid email.</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <h5 style="color: #0369a1; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Personal Information</h5>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profileFirstName">First Name</label>
                                    <input type="text" id="profileFirstName" name="firstName" placeholder="Enter your first name" autocomplete="off" required>
                                    <div class="error-message" id="profileFirstName-error" style="display: none;">First Name is required.</div>
                                </div>
                                <div class="form-group">
                                    <label for="profileLastName">Last Name</label>
                                    <input type="text" id="profileLastName" name="lastName" placeholder="Enter your last name" autocomplete="off" required>
                                    <div class="error-message" id="profileLastName-error" style="display: none;">Last Name is required.</div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profileGender">Gender</label>
                                    <select id="profileGender" name="gender" autocomplete="off" required>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                    <div class="error-message" id="profileGender-error" style="display: none;">Please select an item in the list</div>
                                </div>
                                <div class="form-group">
                                    <label for="profileBirthday">Birthday</label>
                                    <input type="date" id="profileBirthday" name="birthday" autocomplete="off" required>
                                    <div class="error-message" id="profileBirthday-error" style="display: none;">Date of birth is required.</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <h5 style="color: #0369a1; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Change Password</h5>
                            <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 1rem; font-style: italic;">
                                Leave these fields blank if you don't want to change your password.
                            </p>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profilePassword">Current Password</label>
                                    <div style="position: relative;">
                                        <input type="password" id="profilePassword" name="password" placeholder="Enter your current password" autocomplete="off" minlength="8">
                                        <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility('profilePassword', this.querySelector('i'))" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); border: none; background: transparent; padding: 8px 12px;">
                                            <i class="fas fa-eye" id="iconProfilePassword"></i>
                                        </button>
                                    </div>
                                    <div class="error-message" id="profilePassword-required" style="display: none;">Password is required.</div>
                                    <div class="error-message" id="profilePassword-min" style="display: none;">Password must be at least 8 characters.</div>
                                    <div class="error-message" id="profilePassword-incorrect" style="display: none;">Current password is incorrect.</div>
                                </div>
                                <div class="form-group">
                                    <label for="profileNewPassword">New Password</label>
                                    <div style="position: relative;">
                                        <input type="password" id="profileNewPassword" name="newPassword" placeholder="Enter your new password" autocomplete="off" minlength="8">
                                        <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility('profileNewPassword', this.querySelector('i'))" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); border: none; background: transparent; padding: 8px 12px;">
                                            <i class="fas fa-eye" id="iconProfileNewPassword"></i>
                                        </button>
                                    </div>
                                    <div class="error-message" id="profileNewPassword-required" style="display: none;">Password is required.</div>
                                    <div class="error-message" id="profileNewPassword-min" style="display: none;">Password must be at least 8 characters.</div>
                                    <div class="error-message" id="profileNewPassword-same" style="display: none;">You've already used this password before.</div>
                                    
                                    <label for="profileConfirmPassword" style="margin-top: 1rem;">Confirm New Password</label>
                                    <div style="position: relative;">
                                        <input type="password" id="profileConfirmPassword" name="confirmPassword" placeholder="Confirm your new password" autocomplete="off" minlength="8">
                                        <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility('profileConfirmPassword', this.querySelector('i'))" style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); border: none; background: transparent; padding: 8px 12px;">
                                            <i class="fas fa-eye" id="iconProfileConfirmPassword"></i>
                                        </button>
                                    </div>
                                    <div class="error-message" id="profileConfirmPassword-required" style="display: none;">Password is required.</div>
                                    <div class="error-message" id="profileConfirmPassword-min" style="display: none;">Password must be at least 8 characters.</div>
                                    <div class="error-message" id="profileConfirmPassword-same" style="display: none;">You've already used this password before.</div>
                                    <div class="error-message" id="profileConfirmPassword-mismatch" style="display: none;">Passwords do not match.</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-footer">
                            <a href="dashboard.html" class="btn-cancel">Cancel</a>
                            <button type="submit" class="btn-submit" id="updateProfileBtn" disabled>Save Changes</button>
                        </div>
                        </form>
                    </div>
                </div>
                
                <!-- My Address Section (Side by Side) -->
                <div class="cart-summary">
                    <div class="delivery-address-section" id="profileAddressSection">
                    <div class="address-header">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>My Address</span>
                    </div>
                    <div id="profileAddressContent" class="address-content">
                        <div class="empty-address" id="profileEmptyAddress">
                            <p>No delivery address set</p>
                            <button class="btn-add-address" onclick="openProfileAddressModal()">
                                <i class="fas fa-plus me-2"></i>
                                Add Delivery Address
                            </button>
                        </div>
                        <div class="address-display" id="profileAddressDisplay" style="display: none;">
                            <div class="address-header-row">
                                <div class="address-info">
                                    <div class="address-name-phone">
                                        <strong id="profileAddressName"></strong>
                                        <span id="profileAddressPhone"></span>
                                    </div>
                                </div>
                                <div class="address-actions">
                                    <span class="badge-default" id="profileDefaultBadge" style="display: none;">Default</span>
                                </div>
                            </div>
                            
                            <!-- Tabs Navigation -->
                            <div class="address-tabs" id="profileAddressTabs" style="display: none;">
                                <button class="address-tab active" onclick="switchProfileAddressTab('details')" id="profileTabDetails">
                                    <i class="fas fa-info-circle"></i>
                                    Address Details
                                </button>
                                <button class="address-tab" onclick="switchProfileAddressTab('location')" id="profileTabLocation">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Location Map
                                </button>
                            </div>
                            
                            <!-- Tab Content -->
                            <div class="address-tab-content-wrapper">
                                <!-- Address Details Tab -->
                                <div class="address-tab-content active" id="profileTabContentDetails">
                                    <div class="address-text" id="profileAddressText"></div>
                                </div>
                                
                                <!-- Location Map Tab -->
                                <div class="address-tab-content" id="profileTabContentLocation" style="display: none;">
                                    <div class="address-location-section" id="profileAddressLocationSection">
                                        <div class="address-coordinates">
                                            <div class="coordinates-label">
                                                <i class="fas fa-map-marker-alt"></i>
                                                <span>Location Coordinates</span>
                                            </div>
                                            <div class="coordinates-display">
                                                <div class="coordinate-item">
                                                    <span class="coordinate-label">Latitude:</span>
                                                    <span class="coordinate-value" id="profileDisplayLatitude"></span>
                                                </div>
                                                <div class="coordinate-item">
                                                    <span class="coordinate-label">Longitude:</span>
                                                    <span class="coordinate-value" id="profileDisplayLongitude"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="address-map-container" id="profileAddressMapContainer">
                                            <button class="address-map-fullscreen-btn" onclick="toggleProfileAddressMapFullscreen()" title="Toggle fullscreen">
                                                <i class="fas fa-expand" id="profileAddressMapFullscreenIcon"></i>
                                                Fullscreen
                                            </button>
                                            <div id="profileAddressMap" class="address-map"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="address-buttons" style="margin-top: 0.5rem; display: flex; justify-content: flex-end; gap: 0.5rem;">
                                <button class="btn-change-address" onclick="openProfileAddressModal()">Change</button>
                                <button class="btn-delete-address" onclick="deleteProfileAddress()" title="Delete address">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Password Change Success Modal -->
    <div class="password-change-modal" id="passwordChangeModal">
        <div class="password-change-content">
            <div class="password-change-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Password Changed Successfully!</h3>
            <p>For security reasons, please log in again with your new password.</p>
            <div class="password-change-loader">
                <div class="loader-dot"></div>
                <div class="loader-dot"></div>
                <div class="loader-dot"></div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal" onclick="closeSettingsModal(event)" style="display: none;">
        <div class="address-modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Settings</h2>
            </div>
            <div class="modal-body">
                <p style="color: #64748b; text-align: center; padding: 2rem 0;">Settings page coming soon...</p>
            </div>
            <div class="profile-footer">
                <button type="button" class="btn-cancel" onclick="closeSettingsModal(event)">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Logout Confirmation Modal -->
    <div id="logoutConfirmModal" class="logout-confirm-modal">
        <div class="logout-confirm-content">
            <div class="logout-confirm-icon-wrapper">
                <div class="logout-confirm-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
            </div>
            <div class="logout-confirm-body">
                <h3>Confirm Logout</h3>
                <p id="logoutConfirmMessage">Are you sure you want to logout?</p>
            </div>
            <div class="logout-confirm-footer">
                <button type="button" class="btn-logout-cancel" id="logoutCancelBtn">Cancel</button>
                <button type="button" class="btn-logout-confirm" id="logoutConfirmBtn">Logout</button>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-3">
                    <h4 class="footer-title" style="display: flex; align-items: center;">
                        <img src="systemlogo.png" alt="AquaSphere Logo" style="height: 40px; margin-right: 10px;">
                        AquaSphere
                    </h4>
                    <p style="color: rgba(255, 255, 255, 0.8); line-height: 1.7;">
                        Your trusted water delivery service. Fast delivery, clean quality water, and reliable service. 
                        Everything you need for your hydration needs, all in one platform.
                    </p>
                </div>
                
                <div class="col-lg-2 col-md-6 mb-3">
                    <h5 class="footer-title">Quick Links</h5>
                    <a href="dashboard.html" class="footer-link">Home</a>
                    <a href="orders.html" class="footer-link">My Orders</a>
                    <a href="profile.html" class="footer-link">Profile</a>
                    <a href="cart.html" class="footer-link">Cart</a>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <h5 class="footer-title">Features</h5>
                    <a href="#" class="footer-link">Easy Ordering</a>
                    <a href="#" class="footer-link">Delivery Tracking</a>
                    <a href="#" class="footer-link">Payment Options</a>
                    <a href="#" class="footer-link">Customer Support</a>
                </div>
                
                <div class="col-lg-3 mb-3">
                    <h5 class="footer-title">Connect With Us</h5>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <p class="mt-1" style="color: rgba(255, 255, 255, 0.8);">
                        <i class="fas fa-envelope me-2"></i>support@aquasphere.com
                    </p>
                </div>
            </div>
            
            <hr style="border-color: rgba(255, 255, 255, 0.2); margin: 1rem 0 0.8rem;">
            
            <div class="text-center" style="color: rgba(255, 255, 255, 0.8); font-size: 0.8rem;">
                <p>&copy; 2024 AquaSphere. Made with ‚ù§Ô∏è for clean water delivery. All rights reserved.</p>
            </div>
        </div>
    </footer>
    
    <!-- Address Modal -->
    <div class="modal-overlay" id="profileAddressModal" onclick="closeProfileAddressModal(event)">
        <div class="address-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <i class="fas fa-map-marker-alt"></i>
                <h2>New Address</h2>
            </div>
            <div class="modal-body">
                <form id="profileAddressForm" onsubmit="saveProfileAddress(event)" novalidate>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profileFullName">Full Name</label>
                            <input type="text" id="profileFullName" name="fullName" placeholder="Full Name" autocomplete="off" required>
                            <div class="error-message">Please fill out this field</div>
                        </div>
                        <div class="form-group">
                            <label for="profilePhoneNumber">Phone Number</label>
                            <input type="tel" id="profilePhoneNumber" name="phoneNumber" placeholder="Phone Number" autocomplete="off" required>
                            <div class="error-message">Please fill out this field</div>
                        </div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Region</label>
                        <select id="profileRegion" name="region" autocomplete="off" required onchange="updateProfileProvinces(); validateProfileField(this);">
                            <option value="">Select Region</option>
                        </select>
                        <div class="error-message">Please select an item in the list</div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Province</label>
                        <select id="profileProvince" name="province" autocomplete="off" required onchange="updateProfileCities(); validateProfileField(this);" disabled>
                            <option value="">Select Province</option>
                        </select>
                        <div class="error-message">Please select an item in the list</div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>City/Municipality</label>
                        <select id="profileCity" name="city" autocomplete="off" required onchange="updateProfileBarangays(); validateProfileField(this);" disabled>
                            <option value="">Select City/Municipality</option>
                        </select>
                        <div class="error-message">Please select an item in the list</div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Barangay</label>
                        <select id="profileBarangay" name="barangay" autocomplete="off" required onchange="validateProfileField(this);" disabled>
                            <option value="">Select Barangay</option>
                        </select>
                        <div class="error-message">Please select an item in the list</div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="profilePostalCode">Postal Code</label>
                        <input type="text" id="profilePostalCode" name="postalCode" placeholder="Postal Code" autocomplete="off" required>
                        <div class="error-message">Please fill out this field</div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="profileStreetAddress">Street Name, Building, House No.</label>
                        <input type="text" id="profileStreetAddress" name="streetAddress" placeholder="Street Name, Building, House No." autocomplete="off" required>
                        <div class="error-message">Please fill out this field</div>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Location on Map</label>
                        <div id="profileMapPlaceholder" class="map-placeholder">
                            <button type="button" class="btn-add-location" onclick="initProfileMap()">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                Add Location on Map
                            </button>
                        </div>
                        <div id="profileMapContainer" class="map-container" style="display: none;">
                            <div class="map-controls">
                                <button type="button" class="btn-map-control" onclick="getProfileCurrentLocation()" title="Use my current location">
                                    <i class="fas fa-crosshairs"></i>
                                    My Location
                                </button>
                                <button type="button" class="btn-map-control" onclick="toggleProfileMapFullscreen()" title="Toggle fullscreen">
                                    <i class="fas fa-expand" id="profileFullscreenIcon"></i>
                                    Fullscreen
                                </button>
                                <button type="button" class="btn-map-control" onclick="hideProfileMap()" title="Hide map">
                                    <i class="fas fa-times"></i>
                                    Hide
                                </button>
                            </div>
                            <div id="profileMap" style="height: 100%;"></div>
                            <div id="profileMapLoading" class="map-loading" style="display: none;">
                                <i class="fas fa-spinner"></i>
                                <span>Getting your location...</span>
                            </div>
                        </div>
                        <input type="hidden" id="profileLatitude" name="latitude">
                        <input type="hidden" id="profileLongitude" name="longitude">
                        <div class="form-group full-width" id="profileLocationDisplayGroup" style="display: none; margin-top: 1rem;">
                            <label>Location Coordinates</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="profileLatitudeDisplay" class="form-control" placeholder="Latitude" readonly style="background: #f8f9fa; cursor: not-allowed;">
                                <input type="text" id="profileLongitudeDisplay" class="form-control" placeholder="Longitude" readonly style="background: #f8f9fa; cursor: not-allowed;">
                                <button type="button" class="btn-map-control" onclick="clearProfileLocation()" title="Clear location" style="white-space: nowrap; padding: 10px 16px;">
                                    <i class="fas fa-times"></i>
                                    Clear
                                </button>
                            </div>
                            <small style="color: #64748b; margin-top: 0.5rem; display: block;">
                                <i class="fas fa-info-circle"></i> Location has been set. You can click on the map or use "My Location" to change it.
                            </small>
                        </div>
                        <small id="profileLocationHint" style="color: #64748b; margin-top: 0.5rem; display: block;">Click on the map to set your location, or use "My Location" to automatically detect it</small>
                    </div>
                    
                    <div class="label-section">
                        <span>Label As:</span>
                        <div class="label-buttons">
                            <button type="button" class="label-btn active" data-label="home" onclick="selectProfileLabel(this, 'home')">Home</button>
                            <button type="button" class="label-btn" data-label="work" onclick="selectProfileLabel(this, 'work')">Work</button>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeProfileAddressModal(event)">Cancel</button>
                        <button type="submit" class="btn-submit">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Navbar JS -->
    <script src="navbar.js"></script>
    
    <script>
        // Profile validation functions
        const profileSuccessTimers = {};
        let isInitialProfileLoad = false;
        let originalProfileData = {}; // Store original values to detect changes
        
        function markProfileSuccess(el, key) {
            if (!el) return;
            if (isInitialProfileLoad) {
                return;
            }
            el.classList.remove('error');
            el.classList.add('success');
            if (profileSuccessTimers[key]) clearTimeout(profileSuccessTimers[key]);
            profileSuccessTimers[key] = setTimeout(() => {
                el.classList.remove('success');
            }, 3000);
        }
        
        function hideProfileErrors(idBase) {
            const errors = ['error', 'format-error', 'required', 'min', 'same', 'mismatch', 'incorrect'];
            errors.forEach(suffix => {
                const errEl = document.getElementById(idBase + '-' + suffix);
                if (errEl) errEl.style.display = 'none';
            });
        }
        
        function markProfileError(el) {
            if (el) {
                el.classList.add('error');
                el.classList.remove('success');
            }
        }
        
        function markProfileClear(el) {
            if (el) {
                el.classList.remove('error');
            }
        }
        
        // Validate Email
        function validateProfileEmail() {
            const emailInput = document.getElementById('profileEmail');
            if (!emailInput) return true;
            
            hideProfileErrors('profileEmail');
            const v = (emailInput.value || '').trim();
            
            if (!v) {
                const errEl = document.getElementById('profileEmail-error');
                if (errEl) errEl.style.display = 'block';
                markProfileError(emailInput);
                return false;
            }
            
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)) {
                const errEl = document.getElementById('profileEmail-format-error');
                if (errEl) errEl.style.display = 'block';
                markProfileError(emailInput);
                return false;
            }
            
            markProfileClear(emailInput);
            markProfileSuccess(emailInput, 'email');
            return true;
        }
        
        // Validate First Name
        function validateProfileFirstName() {
            const input = document.getElementById('profileFirstName');
            if (!input) return true;
            
            const errEl = document.getElementById('profileFirstName-error');
            if (errEl) errEl.style.display = 'none';
            markProfileClear(input);
            
            const v = (input.value || '').trim();
            if (!v) {
                if (errEl) errEl.style.display = 'block';
                markProfileError(input);
                return false;
            }
            
            markProfileSuccess(input, 'firstName');
            return true;
        }
        
        // Validate Last Name
        function validateProfileLastName() {
            const input = document.getElementById('profileLastName');
            if (!input) return true;
            
            const errEl = document.getElementById('profileLastName-error');
            if (errEl) errEl.style.display = 'none';
            markProfileClear(input);
            
            const v = (input.value || '').trim();
            if (!v) {
                if (errEl) errEl.style.display = 'block';
                markProfileError(input);
                return false;
            }
            
            markProfileSuccess(input, 'lastName');
            return true;
        }
        
        // Validate Gender
        function validateProfileGender() {
            const input = document.getElementById('profileGender');
            if (!input) return true;
            
            const errEl = document.getElementById('profileGender-error');
            if (errEl) errEl.style.display = 'none';
            markProfileClear(input);
            
            if (!input.value) {
                if (errEl) errEl.style.display = 'block';
                markProfileError(input);
                return false;
            }
            
            markProfileSuccess(input, 'gender');
            return true;
        }
        
        // Validate Birthday
        function validateProfileBirthday() {
            const input = document.getElementById('profileBirthday');
            if (!input) return true;
            
            const errEl = document.getElementById('profileBirthday-error');
            if (errEl) errEl.style.display = 'none';
            markProfileClear(input);
            
            const v = (input.value || '').trim();
            if (!v) {
                if (errEl) errEl.style.display = 'block';
                markProfileError(input);
                return false;
            }
            
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            input.max = `${yyyy}-${mm}-${dd}`;
            
            markProfileSuccess(input, 'birthday');
            return true;
        }
        
        // Check if any password field is filled
        function anyPasswordFilled() {
            const current = document.getElementById('profilePassword');
            const newPwd = document.getElementById('profileNewPassword');
            const confirm = document.getElementById('profileConfirmPassword');
            return ((current?.value || '').trim() || (newPwd?.value || '').trim() || (confirm?.value || '').trim()) ? true : false;
        }
        
        // Validate Password Field
        function validateProfilePassword(el, idBase) {
            if (!el) return true;
            hideProfileErrors(idBase);
            if (idBase === 'profilePassword') {
                const incorrectEl = document.getElementById('profilePassword-incorrect');
                if (incorrectEl) incorrectEl.style.display = 'none';
            }
            const v = (el.value || '').trim();
            const requireNow = anyPasswordFilled();
            
            if (!v) {
                if (requireNow) {
                    const req = document.getElementById(idBase + '-required');
                    if (req) req.style.display = 'block';
                    markProfileError(el);
                    return false;
                } else {
                    markProfileClear(el);
                    return true;
                }
            }
            
            if (v.length < 8) {
                const min = document.getElementById(idBase + '-min');
                if (min) min.style.display = 'block';
                markProfileError(el);
                return false;
            }
            
            markProfileClear(el);
            markProfileSuccess(el, idBase);
            return true;
        }
        
        // Validate Password Same As Current
        function validatePasswordSameAsCurrent() {
            const currentEl = document.getElementById('profilePassword');
            const newEl = document.getElementById('profileNewPassword');
            const confirmEl = document.getElementById('profileConfirmPassword');
            
            const curr = (currentEl?.value || '').trim();
            const newv = (newEl?.value || '').trim();
            const conf = (confirmEl?.value || '').trim();
            let ok = true;
            const requireNow = anyPasswordFilled();
            
            if (requireNow && curr && newv && curr === newv) {
                const same = document.getElementById('profileNewPassword-same');
                if (same) same.style.display = 'block';
                markProfileError(newEl);
                ok = false;
            } else {
                const same = document.getElementById('profileNewPassword-same');
                if (same) same.style.display = 'none';
            }
            
            if (requireNow && curr && conf && curr === conf) {
                const same = document.getElementById('profileConfirmPassword-same');
                if (same) same.style.display = 'block';
                markProfileError(confirmEl);
                ok = false;
            } else {
                const same = document.getElementById('profileConfirmPassword-same');
                if (same) same.style.display = 'none';
            }
            
            const mismatchEl = document.getElementById('profileConfirmPassword-mismatch');
            if (requireNow && newv && conf && newv !== conf) {
                if (mismatchEl) mismatchEl.style.display = 'block';
                markProfileError(confirmEl);
                ok = false;
            } else {
                if (mismatchEl) mismatchEl.style.display = 'none';
            }
            
            if (ok && requireNow) {
                if ((newEl?.value || '').trim().length >= 8) markProfileSuccess(newEl, 'profileNewPassword');
                if ((confirmEl?.value || '').trim().length >= 8 && newv === conf) markProfileSuccess(confirmEl, 'profileConfirmPassword');
            }
            
            return ok;
        }
        
        // Check Required Fields and Enable/Disable Update Button
        function checkProfileRequiredFields() {
            const updateBtn = document.getElementById('updateProfileBtn');
            if (!updateBtn) return;
            
            const requiredFields = ['profileEmail', 'profileFirstName', 'profileLastName', 'profileGender', 'profileBirthday'];
            let allValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    const value = (field.value || '').trim();
                    if (!value) {
                        allValid = false;
                    }
                }
            });
            
            if (allValid) {
                allValid = validateProfileEmail();
            }
            
            if (allValid && anyPasswordFilled()) {
                const currentEl = document.getElementById('profilePassword');
                const newEl = document.getElementById('profileNewPassword');
                const confirmEl = document.getElementById('profileConfirmPassword');
                
                allValid = validateProfilePassword(currentEl, 'profilePassword') && allValid;
                allValid = validateProfilePassword(newEl, 'profileNewPassword') && allValid;
                allValid = validateProfilePassword(confirmEl, 'profileConfirmPassword') && allValid;
                allValid = validatePasswordSameAsCurrent() && allValid;
            }
            
            // Check if there are any changes from original values
            if (allValid && typeof originalProfileData !== 'undefined' && Object.keys(originalProfileData).length > 0) {
                const currentEmail = (document.getElementById('profileEmail').value || '').trim();
                const currentFirstName = (document.getElementById('profileFirstName').value || '').trim();
                const currentLastName = (document.getElementById('profileLastName').value || '').trim();
                const currentGender = (document.getElementById('profileGender').value || '').trim();
                const currentBirthday = (document.getElementById('profileBirthday').value || '').trim();
                const newPassword = (document.getElementById('profileNewPassword').value || '').trim();
                
                // Check if any field has changed
                const hasChanges = 
                    currentEmail !== originalProfileData.email ||
                    currentFirstName !== originalProfileData.firstName ||
                    currentLastName !== originalProfileData.lastName ||
                    currentGender !== originalProfileData.gender ||
                    currentBirthday !== originalProfileData.birthday ||
                    (newPassword && newPassword.length > 0);
                
                // If no changes, disable button
                if (!hasChanges) {
                    allValid = false;
                }
            }
            
            if (allValid) {
                updateBtn.disabled = false;
                updateBtn.style.opacity = '1';
                updateBtn.style.cursor = 'pointer';
            } else {
                updateBtn.disabled = true;
                updateBtn.style.opacity = '0.6';
                updateBtn.style.cursor = 'not-allowed';
            }
        }
        
        // Setup Profile Validation Event Listeners
        function setupProfileValidation() {
            const emailInput = document.getElementById('profileEmail');
            const firstNameInput = document.getElementById('profileFirstName');
            const lastNameInput = document.getElementById('profileLastName');
            const genderInput = document.getElementById('profileGender');
            const birthdayInput = document.getElementById('profileBirthday');
            const passwordInput = document.getElementById('profilePassword');
            const newPasswordInput = document.getElementById('profileNewPassword');
            const confirmPasswordInput = document.getElementById('profileConfirmPassword');
            
            if (emailInput) {
                emailInput.addEventListener('input', () => {
                    validateProfileEmail();
                    checkProfileRequiredFields();
                });
                emailInput.addEventListener('blur', () => {
                    validateProfileEmail();
                    checkProfileRequiredFields();
                });
            }
            
            if (firstNameInput) {
                firstNameInput.addEventListener('input', () => {
                    validateProfileFirstName();
                    checkProfileRequiredFields();
                });
                firstNameInput.addEventListener('blur', () => {
                    validateProfileFirstName();
                    checkProfileRequiredFields();
                });
            }
            
            if (lastNameInput) {
                lastNameInput.addEventListener('input', () => {
                    validateProfileLastName();
                    checkProfileRequiredFields();
                });
                lastNameInput.addEventListener('blur', () => {
                    validateProfileLastName();
                    checkProfileRequiredFields();
                });
            }
            
            if (genderInput) {
                genderInput.addEventListener('change', () => {
                    validateProfileGender();
                    checkProfileRequiredFields();
                });
            }
            
            if (birthdayInput) {
                birthdayInput.addEventListener('input', () => {
                    validateProfileBirthday();
                    checkProfileRequiredFields();
                });
                birthdayInput.addEventListener('blur', () => {
                    validateProfileBirthday();
                    checkProfileRequiredFields();
                });
            }
            
            if (passwordInput) {
                passwordInput.addEventListener('input', () => {
                    validateProfilePassword(passwordInput, 'profilePassword');
                    validatePasswordSameAsCurrent();
                    checkProfileRequiredFields();
                });
                passwordInput.addEventListener('blur', () => {
                    validateProfilePassword(passwordInput, 'profilePassword');
                    validatePasswordSameAsCurrent();
                    checkProfileRequiredFields();
                });
            }
            
            if (newPasswordInput) {
                newPasswordInput.addEventListener('input', () => {
                    validateProfilePassword(newPasswordInput, 'profileNewPassword');
                    validatePasswordSameAsCurrent();
                    checkProfileRequiredFields();
                });
                newPasswordInput.addEventListener('blur', () => {
                    validateProfilePassword(newPasswordInput, 'profileNewPassword');
                    validatePasswordSameAsCurrent();
                    checkProfileRequiredFields();
                });
            }
            
            if (confirmPasswordInput) {
                confirmPasswordInput.addEventListener('input', () => {
                    validateProfilePassword(confirmPasswordInput, 'profileConfirmPassword');
                    validatePasswordSameAsCurrent();
                    checkProfileRequiredFields();
                });
                confirmPasswordInput.addEventListener('blur', () => {
                    validateProfilePassword(confirmPasswordInput, 'profileConfirmPassword');
                    validatePasswordSameAsCurrent();
                    checkProfileRequiredFields();
                });
            }
        }
        
        // Toggle Password Visibility
        function togglePasswordVisibility(inputId, icon) {
            const input = document.getElementById(inputId);
            if (!input || !icon) return;
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Show Notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'}`;
            notification.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Load Profile Data
        function loadProfileData() {
            isInitialProfileLoad = true;
            
            const form = document.getElementById('profileForm');
            if (form) {
                form.style.opacity = '0.5';
                form.style.pointerEvents = 'none';
            }
            
            fetch('api/get_current_user.php')
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.message || 'Failed to fetch user data');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success && data.user) {
                        const userData = data.user;
                        
                        localStorage.setItem('loggedInUser', JSON.stringify(userData));
                        localStorage.setItem('userData', JSON.stringify(userData));
                        
                        document.getElementById('profileUsername').value = userData.username || '';
                        document.getElementById('profileEmail').value = userData.email || '';
                        document.getElementById('profileFirstName').value = userData.firstName || userData.first_name || '';
                        document.getElementById('profileLastName').value = userData.lastName || userData.last_name || '';
                        document.getElementById('profileGender').value = userData.gender || '';
                        
                        let birthday = userData.birthday || userData.date_of_birth || '';
                        if (birthday && birthday.includes('/')) {
                            const parts = birthday.split('/');
                            if (parts.length === 3) {
                                birthday = `${parts[2]}-${parts[1]}-${parts[0]}`;
                            }
                        }
                        document.getElementById('profileBirthday').value = birthday;
                        document.getElementById('profilePassword').value = '';
                        document.getElementById('profileNewPassword').value = '';
                        document.getElementById('profileConfirmPassword').value = '';
                        
                        // Store original values to detect changes
                        originalProfileData = {
                            email: userData.email || '',
                            firstName: userData.firstName || userData.first_name || '',
                            lastName: userData.lastName || userData.last_name || '',
                            gender: userData.gender || '',
                            birthday: birthday
                        };
                        
                        const today = new Date();
                        const yyyy = today.getFullYear();
                        const mm = String(today.getMonth() + 1).padStart(2, '0');
                        const dd = String(today.getDate()).padStart(2, '0');
                        document.getElementById('profileBirthday').max = `${yyyy}-${mm}-${dd}`;
                        
                        setupProfileValidation();
                        checkProfileRequiredFields();
                        
                        setTimeout(() => {
                            isInitialProfileLoad = false;
                        }, 500);
                        
                        if (form) {
                            form.style.opacity = '1';
                            form.style.pointerEvents = 'auto';
                        }
                    } else {
                        let userData = JSON.parse(localStorage.getItem('loggedInUser')) || 
                                      JSON.parse(localStorage.getItem('userData')) || {};
                        
                        document.getElementById('profileUsername').value = userData.username || '';
                        document.getElementById('profileEmail').value = userData.email || '';
                        document.getElementById('profileFirstName').value = userData.firstName || userData.first_name || '';
                        document.getElementById('profileLastName').value = userData.lastName || userData.last_name || '';
                        document.getElementById('profileGender').value = userData.gender || '';
                        
                        let birthday = userData.birthday || userData.date_of_birth || '';
                        if (birthday && birthday.includes('/')) {
                            const parts = birthday.split('/');
                            if (parts.length === 3) {
                                birthday = `${parts[2]}-${parts[1]}-${parts[0]}`;
                            }
                        }
                        document.getElementById('profileBirthday').value = birthday;
                        document.getElementById('profilePassword').value = '';
                        document.getElementById('profileNewPassword').value = '';
                        document.getElementById('profileConfirmPassword').value = '';
                        
                        // Store original values to detect changes
                        originalProfileData = {
                            email: userData.email || '',
                            firstName: userData.firstName || userData.first_name || '',
                            lastName: userData.lastName || userData.last_name || '',
                            gender: userData.gender || '',
                            birthday: birthday
                        };
                        
                        const today = new Date();
                        const yyyy = today.getFullYear();
                        const mm = String(today.getMonth() + 1).padStart(2, '0');
                        const dd = String(today.getDate()).padStart(2, '0');
                        document.getElementById('profileBirthday').max = `${yyyy}-${mm}-${dd}`;
                        
                        setupProfileValidation();
                        checkProfileRequiredFields();
                        
                        setTimeout(() => {
                            isInitialProfileLoad = false;
                        }, 500);
                        
                        if (form) {
                            form.style.opacity = '1';
                            form.style.pointerEvents = 'auto';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                    
                    let userData = JSON.parse(localStorage.getItem('loggedInUser')) || 
                                  JSON.parse(localStorage.getItem('userData')) || {};
                    
                    document.getElementById('profileUsername').value = userData.username || '';
                    document.getElementById('profileEmail').value = userData.email || '';
                    document.getElementById('profileFirstName').value = userData.firstName || userData.first_name || '';
                    document.getElementById('profileLastName').value = userData.lastName || userData.last_name || '';
                    document.getElementById('profileGender').value = userData.gender || '';
                    
                    let birthday = userData.birthday || userData.date_of_birth || '';
                    if (birthday && birthday.includes('/')) {
                        const parts = birthday.split('/');
                        if (parts.length === 3) {
                            birthday = `${parts[2]}-${parts[1]}-${parts[0]}`;
                        }
                    }
                    document.getElementById('profileBirthday').value = birthday;
                    document.getElementById('profilePassword').value = '';
                    document.getElementById('profileNewPassword').value = '';
                    document.getElementById('profileConfirmPassword').value = '';
                    
                    // Store original values to detect changes
                    originalProfileData = {
                        email: userData.email || '',
                        firstName: userData.firstName || userData.first_name || '',
                        lastName: userData.lastName || userData.last_name || '',
                        gender: userData.gender || '',
                        birthday: birthday
                    };
                    
                    const today = new Date();
                    const yyyy = today.getFullYear();
                    const mm = String(today.getMonth() + 1).padStart(2, '0');
                    const dd = String(today.getDate()).padStart(2, '0');
                    document.getElementById('profileBirthday').max = `${yyyy}-${mm}-${dd}`;
                    
                    setupProfileValidation();
                    checkProfileRequiredFields();
                    
                    setTimeout(() => {
                        isInitialProfileLoad = false;
                    }, 500);
                    
                    if (form) {
                        form.style.opacity = '1';
                        form.style.pointerEvents = 'auto';
                    }
                });
        }
        
        // Save Profile
        function saveProfile(event) {
            event.preventDefault();
            
            const updateBtn = document.getElementById('updateProfileBtn');
            if (updateBtn && updateBtn.disabled) {
                return;
            }
            
            let isValid = true;
            isValid = validateProfileEmail() && isValid;
            isValid = validateProfileFirstName() && isValid;
            isValid = validateProfileLastName() && isValid;
            isValid = validateProfileGender() && isValid;
            isValid = validateProfileBirthday() && isValid;
            
            if (anyPasswordFilled()) {
                const currentEl = document.getElementById('profilePassword');
                const newEl = document.getElementById('profileNewPassword');
                const confirmEl = document.getElementById('profileConfirmPassword');
                
                isValid = validateProfilePassword(currentEl, 'profilePassword') && isValid;
                isValid = validateProfilePassword(newEl, 'profileNewPassword') && isValid;
                isValid = validateProfilePassword(confirmEl, 'profileConfirmPassword') && isValid;
                isValid = validatePasswordSameAsCurrent() && isValid;
            }
            
            if (!isValid) {
                const firstError = document.querySelector('.form-group.error, input.error, select.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }
            
            const currentPassword = document.getElementById('profilePassword').value.trim();
            const newPassword = document.getElementById('profileNewPassword').value.trim();
            const confirmPassword = document.getElementById('profileConfirmPassword').value.trim();
            
            if (newPassword || confirmPassword || currentPassword) {
                if (!currentPassword) {
                    showNotification('Please enter your current password to change it', 'error');
                    return;
                }
                
                if (!newPassword) {
                    showNotification('Please enter a new password', 'error');
                    return;
                }
                
                if (newPassword.length < 8) {
                    showNotification('New password must be at least 8 characters', 'error');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showNotification('New passwords do not match', 'error');
                    return;
                }
            }
            
            const userData = {
                email: document.getElementById('profileEmail').value.trim(),
                firstName: document.getElementById('profileFirstName').value.trim(),
                lastName: document.getElementById('profileLastName').value.trim(),
                gender: document.getElementById('profileGender').value,
                birthday: document.getElementById('profileBirthday').value,
                first_name: document.getElementById('profileFirstName').value.trim(),
                last_name: document.getElementById('profileLastName').value.trim(),
                date_of_birth: document.getElementById('profileBirthday').value
            };
            
            if (currentPassword) {
                userData.password = currentPassword;
            }
            if (newPassword) {
                userData.newPassword = newPassword;
            }
            
            if (updateBtn) {
                updateBtn.disabled = true;
                updateBtn.textContent = 'Saving...';
            }
            
            fetch('api/update_profile.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const passwordChanged = newPassword && newPassword.length > 0;
                    
                    const updatedUserData = {
                        username: document.getElementById('profileUsername').value.trim(),
                        email: userData.email,
                        firstName: userData.firstName,
                        lastName: userData.lastName,
                        first_name: userData.first_name,
                        last_name: userData.last_name,
                        gender: userData.gender,
                        birthday: userData.birthday,
                        date_of_birth: userData.date_of_birth
                    };
                    
                    localStorage.setItem('userData', JSON.stringify(updatedUserData));
                    localStorage.setItem('loggedInUser', JSON.stringify(updatedUserData));
                    sessionStorage.setItem('userData', JSON.stringify(updatedUserData));
                    
                    if (typeof loadUserData === 'function') {
                        loadUserData();
                    }
                    
                    if (passwordChanged) {
                        // Show password change success modal
                        const passwordModal = document.getElementById('passwordChangeModal');
                        if (passwordModal) {
                            passwordModal.classList.add('active');
                            document.body.style.overflow = 'hidden';
                        }
                        
                        // Redirect after giving user time to read (5 seconds)
                        setTimeout(() => {
                            localStorage.removeItem('loggedInUser');
                            sessionStorage.removeItem('userData');
                            window.location.href = 'login.html';
                        }, 5000);
                    } else {
                        showNotification('Profile updated successfully!', 'success');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 1500);
                    }
                } else {
                    if (data.errors) {
                        Object.keys(data.errors).forEach(field => {
                            const errorMsg = data.errors[field];
                            
                            if (field === 'password' && errorMsg.includes('incorrect')) {
                                const errorEl = document.getElementById('profilePassword-incorrect');
                                if (errorEl) {
                                    errorEl.style.display = 'block';
                                    const passwordInput = document.getElementById('profilePassword');
                                    if (passwordInput) {
                                        markProfileError(passwordInput);
                                        const formGroup = passwordInput.closest('.form-group');
                                        if (formGroup) {
                                            formGroup.classList.add('error');
                                        }
                                    }
                                }
                            } else {
                                showNotification(errorMsg, 'error');
                            }
                        });
                    } else {
                        showNotification(data.message || 'Failed to update profile. Please try again.', 'error');
                    }
                    
                    if (updateBtn) {
                        updateBtn.disabled = false;
                        updateBtn.textContent = 'Save Changes';
                    }
                }
            })
            .catch(error => {
                console.error('Error updating profile:', error);
                showNotification('An error occurred while updating your profile. Please try again.', 'error');
                
                if (updateBtn) {
                    updateBtn.disabled = false;
                    updateBtn.textContent = 'Save Changes';
                }
            });
        }
        
        // Open Settings Modal
        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            if (!modal) return;
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        // Close Settings Modal
        function closeSettingsModal(event) {
            if (event && event.target.id !== 'settingsModal' && !event.target.closest('.address-modal')) return;
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }
        
        // Show Logout Confirmation Modal
        function showLogoutConfirmModal() {
            const modal = document.getElementById('logoutConfirmModal');
            const confirmBtn = document.getElementById('logoutConfirmBtn');
            const cancelBtn = document.getElementById('logoutCancelBtn');
            
            if (!modal) return;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Remove existing event listeners by cloning buttons
            const newConfirmBtn = confirmBtn.cloneNode(true);
            const newCancelBtn = cancelBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
            
            // Add new event listeners
            newConfirmBtn.addEventListener('click', function confirmHandler() {
                modal.classList.remove('active');
                document.body.style.overflow = '';
                performLogout();
                newConfirmBtn.removeEventListener('click', confirmHandler);
            });
            
            newCancelBtn.addEventListener('click', function cancelHandler() {
                modal.classList.remove('active');
                document.body.style.overflow = '';
                newCancelBtn.removeEventListener('click', cancelHandler);
            });
        }
        
        // Perform Logout
        function performLogout() {
            // Call API to logout
            fetch('api/logout.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                // Clear user session data
                localStorage.removeItem('loggedInUser');
                sessionStorage.removeItem('userData');
                
                // Redirect to index page
                window.location.href = 'index.html';
            })
            .catch(error => {
                console.error('Error logging out:', error);
                // Still clear local data and redirect even if API fails
                localStorage.removeItem('loggedInUser');
                sessionStorage.removeItem('userData');
                window.location.href = 'index.html';
            });
        }
        
        // Logout
        function logout() {
            showLogoutConfirmModal();
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProfileData();
            loadProfileAddress();
        });
        
        // Address Management for Profile Page
        // Uses same localStorage key ('deliveryAddress') to sync with cart
        
        // Laguna Location Data Only (CALABARZON Region)
        const profilePhilippineLocations = {
            'CALABARZON': {
                name: 'IV-A ‚Äì CALABARZON',
                provinces: {
                    'Laguna': {
                        cities: {
                            'Alaminos': {
                                barangays: ['Barangay I (Pob.)', 'Barangay II (Pob.)', 'Barangay III (Pob.)', 'Barangay IV (Pob.)', 'Del Carmen', 'Gulod', 'Magsaysay', 'Poblacion', 'San Agustin', 'San Andres', 'San Benito', 'San Gregorio', 'San Isidro', 'San Jose', 'San Juan', 'San Miguel', 'San Pablo', 'San Roque', 'Santa Cruz', 'Santa Maria', 'Santo Ni√±o', 'Santo Tomas']
                            },
                            'Bay': {
                                barangays: ['Bitin', 'Calo', 'Dila', 'Maitim', 'Masaya', 'Paciano Rizal', 'Puypuy', 'San Agustin', 'San Antonio', 'San Isidro', 'Tagumpay', 'Tranca']
                            },
                            'Bi√±an': {
                                barangays: ['Bungahan', 'Canlalay', 'Casile', 'De La Paz', 'Ganado', 'Langkiwa', 'Loma', 'Malaban', 'Malamig', 'Mampalasan', 'Platero', 'Poblacion', 'San Antonio', 'San Francisco', 'San Jose', 'San Vicente', 'Santo Domingo', 'Santo Ni√±o', 'Santo Tomas', 'Soro-Soro', 'Timbao', 'Tubigan', 'Zapote']
                            },
                            'Calauan': {
                                barangays: ['San Isidro', 'Poblacion I', 'Poblacion II', 'Poblacion III', 'Poblacion IV', 'Bubukal', 'Masili', 'Dayap', 'Lamot I', 'Lamot II', 'Limao', 'Mabacan', 'Masiit', 'Paliparan', 'Pansol', 'San Antonio', 'San Cristobal', 'San Juan', 'San Pablo', 'San Salvador', 'Santo Tomas', 'Santo Toribio', 'Talangan', 'Tambo', 'Tiaong', 'Tulay', 'Ulat', 'Ulong Tubig', 'Villa Espina', 'Villa Mercedes']
                            },
                            'Calamba': {
                                barangays: ['Bagong Kalsada', 'Banadero', 'Banlic', 'Barandal', 'Bucal', 'Bunggo', 'Burol', 'Camaligan', 'Canlubang', 'Halang', 'Hornalan', 'Kay-Anlog', 'La Mesa', 'Laguerta', 'Lawa', 'Lecheria', 'Lingga', 'Looc', 'Mabato', 'Majada Labas', 'Makiling', 'Mapagong', 'Masili', 'Maunong', 'Mayapa', 'Paciano Rizal', 'Palingon', 'Palo-Alto', 'Pansol', 'Parian', 'Prinza', 'Pulo', 'Puting Lupa', 'Real', 'Saimsim', 'Sampiruhan', 'San Cristobal', 'San Jose', 'San Juan', 'San Nicolas', 'San Roque', 'Santo Tomas', 'Sucol', 'Turbina', 'Ulango', 'Uwisan']
                            },
                            'Los Ba√±os': {
                                barangays: ['Anos', 'Bagong Silang', 'Bambang', 'Batong Malake', 'Baybayin', 'Lalakay', 'Maahas', 'Malinta', 'Mayondon', 'Putho-Tuntungin', 'San Antonio', 'Tadlac', 'Timugan']
                            },
                            'San Pedro': {
                                barangays: ['Bagong Silang', 'Calendola', 'Cuyab', 'Estrella', 'Landayan', 'Langgam', 'Magsaysay', 'Narra', 'Nueva', 'Pacita Complex I', 'Pacita Complex II', 'Poblacion', 'Rosario', 'San Antonio', 'San Roque', 'San Vicente', 'Santo Ni√±o', 'United Bayanihan', 'United Better Living']
                            },
                            'Santa Rosa': {
                                barangays: ['Aplaya', 'Balibago', 'Caingin', 'Dila', 'Labas', 'Macabling', 'Malitlit', 'Malusak', 'Poblacion', 'Pulong Santa Cruz', 'Sinalhan', 'Tagapo']
                            },
                            'Sta. Cruz': {
                                barangays: ['Bagumbayan', 'Bubukal', 'Calios', 'Duhat', 'Gatid', 'Jasaan', 'Labuin', 'Malinao', 'Oogong', 'Pagsawitan', 'Paiisa', 'Palasan', 'Patimbao', 'San Jose', 'San Juan', 'San Pablo Norte', 'San Pablo Sur', 'Santo Angel Norte', 'Santo Angel Sur', 'Santo Domingo', 'Tagbakin', 'Tuburan']
                            }
                        }
                    }
                }
            }
        };
        
        // Map variables for profile
        let profileMap = null;
        let profileMarker = null;
        let profileMapInitialized = false;
        let profileAddressMap = null;
        let profileAddressMarker = null;
        
        // Check if Leaflet is ready
        function isProfileMapReady() {
            return typeof L !== 'undefined' && L.map;
        }
        
        // Load address display
        function loadProfileAddress() {
            const address = JSON.parse(localStorage.getItem('deliveryAddress'));
            const emptyAddress = document.getElementById('profileEmptyAddress');
            const addressDisplay = document.getElementById('profileAddressDisplay');
            const addressTabs = document.getElementById('profileAddressTabs');
            
            if (address) {
                emptyAddress.style.display = 'none';
                addressDisplay.style.display = 'block';
                document.getElementById('profileAddressName').textContent = address.fullName;
                document.getElementById('profileAddressPhone').textContent = `(${address.phoneNumber})`;
                
                // Display full address
                let locationText = '';
                if (address.barangay && address.city && address.province) {
                    locationText = `${address.streetAddress}, ${address.barangay}, ${address.city}, ${address.province} ${address.postalCode || ''}`;
                } else if (address.location) {
                    locationText = `${address.streetAddress}, ${address.location}, ${address.postalCode || ''}`;
                } else {
                    locationText = `${address.streetAddress}, ${address.postalCode || ''}`;
                }
                document.getElementById('profileAddressText').textContent = locationText.trim();
                
                // Display coordinates and map if available
                if (address.latitude && address.longitude) {
                    const lat = parseFloat(address.latitude);
                    const lng = parseFloat(address.longitude);
                    
                    // Show tabs
                    if (addressTabs) {
                        addressTabs.style.display = 'flex';
                    }
                    
                    // Display coordinates
                    document.getElementById('profileDisplayLatitude').textContent = lat.toFixed(6);
                    document.getElementById('profileDisplayLongitude').textContent = lng.toFixed(6);
                    
                    // Initialize map
                    setTimeout(() => {
                        initProfileAddressMap(lat, lng);
                    }, 300);
                    
                    // Reset to details tab by default
                    switchProfileAddressTab('details');
                } else {
                    if (addressTabs) {
                        addressTabs.style.display = 'none';
                    }
                }
                
                if (address.isDefault) {
                    document.getElementById('profileDefaultBadge').style.display = 'block';
                } else {
                    document.getElementById('profileDefaultBadge').style.display = 'none';
                }
            } else {
                emptyAddress.style.display = 'block';
                addressDisplay.style.display = 'none';
                if (addressTabs) {
                    addressTabs.style.display = 'none';
                }
            }
        }
        
        // Switch address tab
        function switchProfileAddressTab(tabName) {
            const tabDetails = document.getElementById('profileTabDetails');
            const tabLocation = document.getElementById('profileTabLocation');
            const contentDetails = document.getElementById('profileTabContentDetails');
            const contentLocation = document.getElementById('profileTabContentLocation');
            
            if (tabName === 'details') {
                tabDetails.classList.add('active');
                tabLocation.classList.remove('active');
                contentDetails.style.display = 'block';
                contentDetails.classList.add('active');
                contentLocation.style.display = 'none';
                contentLocation.classList.remove('active');
            } else if (tabName === 'location') {
                tabLocation.classList.add('active');
                tabDetails.classList.remove('active');
                contentLocation.style.display = 'block';
                contentLocation.classList.add('active');
                contentDetails.style.display = 'none';
                contentDetails.classList.remove('active');
                
                setTimeout(() => {
                    if (profileAddressMap) {
                        profileAddressMap.invalidateSize();
                    }
                }, 200);
            }
        }
        
        // Initialize address map for display
        function initProfileAddressMap(lat, lng) {
            const addressMapDiv = document.getElementById('profileAddressMap');
            if (!addressMapDiv || !isProfileMapReady()) return;
            
            if (profileAddressMap) {
                profileAddressMap.remove();
                profileAddressMap = null;
                profileAddressMarker = null;
            }
            
            try {
                profileAddressMap = L.map(addressMapDiv, {
                    center: [lat, lng],
                    zoom: 16,
                    zoomControl: true
                });
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(profileAddressMap);
                
                const customIcon = L.icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                });
                
                profileAddressMarker = L.marker([lat, lng], {
                    icon: customIcon,
                    draggable: false
                }).addTo(profileAddressMap);
                
                const addressPopup = L.popup().setContent('<div style="padding: 8px;"><strong>Your delivery location</strong></div>');
                profileAddressMarker.bindPopup(addressPopup).openPopup();
                
                setTimeout(() => {
                    if (profileAddressMap) {
                        profileAddressMap.invalidateSize();
                    }
                }, 200);
            } catch(error) {
                console.error('Error initializing profile address map:', error);
            }
        }
        
        // Toggle address map fullscreen
        function toggleProfileAddressMapFullscreen() {
            const addressMapContainer = document.getElementById('profileAddressMapContainer');
            const fullscreenIcon = document.getElementById('profileAddressMapFullscreenIcon');
            
            if (!addressMapContainer) return;
            
            if (addressMapContainer.classList.contains('fullscreen')) {
                addressMapContainer.classList.remove('fullscreen');
                if (fullscreenIcon) {
                    fullscreenIcon.classList.remove('fa-compress');
                    fullscreenIcon.classList.add('fa-expand');
                }
                if (profileAddressMap) {
                    setTimeout(() => {
                        profileAddressMap.invalidateSize();
                    }, 100);
                }
            } else {
                addressMapContainer.classList.add('fullscreen');
                if (fullscreenIcon) {
                    fullscreenIcon.classList.remove('fa-expand');
                    fullscreenIcon.classList.add('fa-compress');
                }
                if (profileAddressMap) {
                    setTimeout(() => {
                        profileAddressMap.invalidateSize();
                    }, 100);
                }
            }
        }
        
        // Open address modal
        function openProfileAddressModal() {
            const modal = document.getElementById('profileAddressModal');
            if (!modal) return;
            
            const address = JSON.parse(localStorage.getItem('deliveryAddress'));
            
            initializeProfileLocationDropdowns();
            
            profileMapInitialized = false;
            const mapPlaceholder = document.getElementById('profileMapPlaceholder');
            const mapContainer = document.getElementById('profileMapContainer');
            if (mapPlaceholder) mapPlaceholder.style.display = 'flex';
            if (mapContainer) mapContainer.style.display = 'none';
            
            if (address) {
                document.getElementById('profileFullName').value = address.fullName || '';
                document.getElementById('profilePhoneNumber').value = address.phoneNumber || '';
                document.getElementById('profilePostalCode').value = address.postalCode || '';
                document.getElementById('profileStreetAddress').value = address.streetAddress || '';
                
                if (address.latitude && address.longitude) {
                    document.getElementById('profileLatitude').value = address.latitude;
                    document.getElementById('profileLongitude').value = address.longitude;
                    updateProfileLocationDisplay(parseFloat(address.latitude), parseFloat(address.longitude));
                } else {
                    document.getElementById('profileLatitude').value = '';
                    document.getElementById('profileLongitude').value = '';
                    const locationDisplayGroup = document.getElementById('profileLocationDisplayGroup');
                    const locationHint = document.getElementById('profileLocationHint');
                    if (locationDisplayGroup) locationDisplayGroup.style.display = 'none';
                    if (locationHint) locationHint.style.display = 'block';
                }
                
                if (address.region) {
                    document.getElementById('profileRegion').value = address.region;
                    updateProfileProvinces();
                    setTimeout(() => {
                        if (address.province) {
                            document.getElementById('profileProvince').value = address.province;
                            updateProfileCities();
                            setTimeout(() => {
                                if (address.city) {
                                    document.getElementById('profileCity').value = address.city;
                                    updateProfileBarangays();
                                    setTimeout(() => {
                                        if (address.barangay) {
                                            document.getElementById('profileBarangay').value = address.barangay;
                                        }
                                    }, 100);
                                }
                            }, 100);
                        }
                    }, 100);
                }
                
                document.querySelectorAll('#profileAddressForm .label-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.label === address.label) {
                        btn.classList.add('active');
                    }
                });
            } else {
                document.getElementById('profileAddressForm').reset();
                document.getElementById('profileRegion').value = '';
                document.getElementById('profileProvince').innerHTML = '<option value="">Select Province</option>';
                document.getElementById('profileProvince').disabled = true;
                document.getElementById('profileCity').innerHTML = '<option value="">Select City/Municipality</option>';
                document.getElementById('profileCity').disabled = true;
                document.getElementById('profileBarangay').innerHTML = '<option value="">Select Barangay</option>';
                document.getElementById('profileBarangay').disabled = true;
                document.querySelectorAll('#profileAddressForm .label-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('#profileAddressForm .label-btn[data-label="home"]').classList.add('active');
                clearProfileLocation();
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        // Close address modal
        function closeProfileAddressModal(event) {
            if (event && event.target.id !== 'profileAddressModal' && !event.target.closest('.address-modal')) return;
            const modal = document.getElementById('profileAddressModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
                
                const mapPlaceholder = document.getElementById('profileMapPlaceholder');
                const mapContainer = document.getElementById('profileMapContainer');
                if (mapPlaceholder) mapPlaceholder.style.display = 'flex';
                if (mapContainer) mapContainer.style.display = 'none';
            }
        }
        
        // Initialize location dropdowns
        function initializeProfileLocationDropdowns() {
            const regionSelect = document.getElementById('profileRegion');
            if (!regionSelect) return;
            
            regionSelect.innerHTML = '<option value="">Select Region</option>';
            
            Object.keys(profilePhilippineLocations).forEach(regionCode => {
                const region = profilePhilippineLocations[regionCode];
                const option = document.createElement('option');
                option.value = regionCode;
                option.textContent = region.name;
                regionSelect.appendChild(option);
            });
            
            if (Object.keys(profilePhilippineLocations).length === 1) {
                regionSelect.value = Object.keys(profilePhilippineLocations)[0];
                updateProfileProvinces();
            }
        }
        
        // Update provinces
        function updateProfileProvinces() {
            const regionSelect = document.getElementById('profileRegion');
            const provinceSelect = document.getElementById('profileProvince');
            const citySelect = document.getElementById('profileCity');
            const barangaySelect = document.getElementById('profileBarangay');
            
            const selectedRegion = regionSelect.value;
            
            provinceSelect.innerHTML = '<option value="">Select Province</option>';
            citySelect.innerHTML = '<option value="">Select City/Municipality</option>';
            barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
            
            if (selectedRegion && profilePhilippineLocations[selectedRegion]) {
                provinceSelect.disabled = false;
                const provinces = profilePhilippineLocations[selectedRegion].provinces;
                
                Object.keys(provinces).forEach(provinceName => {
                    const option = document.createElement('option');
                    option.value = provinceName;
                    option.textContent = provinceName;
                    provinceSelect.appendChild(option);
                });
            } else {
                provinceSelect.disabled = true;
                citySelect.disabled = true;
                barangaySelect.disabled = true;
            }
        }
        
        // Update cities
        function updateProfileCities() {
            const regionSelect = document.getElementById('profileRegion');
            const provinceSelect = document.getElementById('profileProvince');
            const citySelect = document.getElementById('profileCity');
            const barangaySelect = document.getElementById('profileBarangay');
            
            const selectedRegion = regionSelect.value;
            const selectedProvince = provinceSelect.value;
            
            citySelect.innerHTML = '<option value="">Select City/Municipality</option>';
            barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
            
            if (selectedRegion && selectedProvince && profilePhilippineLocations[selectedRegion]) {
                const province = profilePhilippineLocations[selectedRegion].provinces[selectedProvince];
                if (province) {
                    citySelect.disabled = false;
                    const cities = province.cities;
                    
                    Object.keys(cities).forEach(cityName => {
                        const option = document.createElement('option');
                        option.value = cityName;
                        option.textContent = cityName;
                        citySelect.appendChild(option);
                    });
                }
            } else {
                citySelect.disabled = true;
                barangaySelect.disabled = true;
            }
        }
        
        // Update barangays
        function updateProfileBarangays() {
            const regionSelect = document.getElementById('profileRegion');
            const provinceSelect = document.getElementById('profileProvince');
            const citySelect = document.getElementById('profileCity');
            const barangaySelect = document.getElementById('profileBarangay');
            
            const selectedRegion = regionSelect.value;
            const selectedProvince = provinceSelect.value;
            const selectedCity = citySelect.value;
            
            barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
            
            if (selectedRegion && selectedProvince && selectedCity && profilePhilippineLocations[selectedRegion]) {
                const province = profilePhilippineLocations[selectedRegion].provinces[selectedProvince];
                if (province && province.cities[selectedCity]) {
                    barangaySelect.disabled = false;
                    const barangays = province.cities[selectedCity].barangays;
                    
                    barangays.forEach(barangayName => {
                        const option = document.createElement('option');
                        option.value = barangayName;
                        option.textContent = barangayName;
                        barangaySelect.appendChild(option);
                    });
                }
            } else {
                barangaySelect.disabled = true;
            }
        }
        
        // Validate field
        function validateProfileField(field) {
            const formGroup = field.closest('.form-group');
            if (field.checkValidity()) {
                formGroup.classList.remove('error');
            } else {
                formGroup.classList.add('error');
            }
        }
        
        // Select label
        function selectProfileLabel(button, label) {
            document.querySelectorAll('#profileAddressForm .label-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
        }
        
        // Initialize map
        function initProfileMap() {
            const mapPlaceholder = document.getElementById('profileMapPlaceholder');
            const mapContainer = document.getElementById('profileMapContainer');
            const mapDiv = document.getElementById('profileMap');
            
            if (!mapDiv || !isProfileMapReady()) return;
            
            if (mapPlaceholder) mapPlaceholder.style.display = 'none';
            if (mapContainer) mapContainer.style.display = 'block';
            
            const mapLoading = document.getElementById('profileMapLoading');
            if (mapLoading) mapLoading.style.display = 'flex';
            
            setTimeout(() => {
                try {
                    if (!profileMapInitialized) {
                        const defaultCenter = [14.1500, 121.3167];
                        const address = JSON.parse(localStorage.getItem('deliveryAddress'));
                        let center = defaultCenter;
                        let zoom = 13;
                        
                        if (address && address.latitude && address.longitude) {
                            center = [parseFloat(address.latitude), parseFloat(address.longitude)];
                            zoom = 16;
                        }
                        
                        profileMap = L.map(mapDiv, {
                            center: center,
                            zoom: zoom,
                            zoomControl: true
                        });
                        
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                            maxZoom: 19
                        }).addTo(profileMap);
                        
                        const customIcon = L.icon({
                            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                            iconSize: [25, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [1, -34],
                            shadowSize: [41, 41]
                        });
                        
                        if (address && address.latitude && address.longitude) {
                            const savedLat = parseFloat(address.latitude);
                            const savedLng = parseFloat(address.longitude);
                            
                            profileMarker = L.marker([savedLat, savedLng], {
                                icon: customIcon,
                                draggable: true
                            }).addTo(profileMap);
                            
                            const popup = L.popup().setContent('<div style="padding: 8px;"><strong>Your location</strong></div>');
                            profileMarker.bindPopup(popup).openPopup();
                            
                            document.getElementById('profileLatitude').value = savedLat;
                            document.getElementById('profileLongitude').value = savedLng;
                            updateProfileLocationDisplay(savedLat, savedLng);
                            
                            profileMarker.on('dragend', function(e) {
                                const position = profileMarker.getLatLng();
                                const lat = position.lat;
                                const lng = position.lng;
                                document.getElementById('profileLatitude').value = lat;
                                document.getElementById('profileLongitude').value = lng;
                                updateProfileLocationDisplay(lat, lng);
                            });
                        }
                        
                        profileMap.on('click', function(e) {
                            const lat = e.latlng.lat;
                            const lng = e.latlng.lng;
                            
                            if (profileMarker) {
                                profileMap.removeLayer(profileMarker);
                            }
                            
                            profileMarker = L.marker([lat, lng], {
                                icon: customIcon,
                                draggable: true
                            }).addTo(profileMap);
                            
                            const popup = L.popup().setContent('<div style="padding: 8px;"><strong>Your location</strong></div>');
                            profileMarker.bindPopup(popup).openPopup();
                            
                            document.getElementById('profileLatitude').value = lat;
                            document.getElementById('profileLongitude').value = lng;
                            updateProfileLocationDisplay(lat, lng);
                            
                            profileMarker.on('dragend', function(e) {
                                const position = profileMarker.getLatLng();
                                const newLat = position.lat;
                                const newLng = position.lng;
                                document.getElementById('profileLatitude').value = newLat;
                                document.getElementById('profileLongitude').value = newLng;
                                updateProfileLocationDisplay(newLat, newLng);
                            });
                        });
                        
                        profileMapInitialized = true;
                    }
                    
                    setTimeout(() => {
                        if (profileMap) {
                            profileMap.invalidateSize();
                        }
                        if (mapLoading) mapLoading.style.display = 'none';
                    }, 100);
                } catch(error) {
                    console.error('Error initializing profile map:', error);
                    if (mapLoading) mapLoading.style.display = 'none';
                    alert('Error loading map. Please try again.');
                }
            }, 50);
        }
        
        // Get current location
        function getProfileCurrentLocation() {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser');
                return;
            }
            
            const mapContainer = document.getElementById('profileMapContainer');
            const mapPlaceholder = document.getElementById('profileMapPlaceholder');
            
            if (!profileMapInitialized || !mapContainer || mapContainer.style.display === 'none') {
                if (mapPlaceholder && mapPlaceholder.style.display !== 'none') {
                    initProfileMap();
                    setTimeout(() => {
                        requestProfileLocation();
                    }, 500);
                    return;
                }
            }
            
            requestProfileLocation();
        }
        
        // Request location
        function requestProfileLocation() {
            const mapLoading = document.getElementById('profileMapLoading');
            if (mapLoading) {
                mapLoading.style.display = 'flex';
                mapLoading.querySelector('span').textContent = 'Getting your location...';
            }
            
            const mapContainer = document.getElementById('profileMapContainer');
            if (mapContainer) {
                mapContainer.style.display = 'block';
            }
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;
                    
                    if (accuracy > 1000) {
                        showNotification('Location accuracy is limited. The marker may not be exactly at your location. You can drag it to adjust.', 'warning');
                    }
                    
                    document.getElementById('profileLatitude').value = lat;
                    document.getElementById('profileLongitude').value = lng;
                    updateProfileLocationDisplay(lat, lng);
                    
                    if (!profileMapInitialized || !profileMap) {
                        initProfileMap();
                        setTimeout(() => {
                            setProfileMapLocation(lat, lng);
                        }, 1000);
                    } else {
                        setProfileMapLocation(lat, lng);
                    }
                    
                    if (mapLoading) {
                        mapLoading.style.display = 'none';
                    }
                },
                function(error) {
                    if (mapLoading) {
                        mapLoading.style.display = 'none';
                    }
                    
                    let errorMsg = 'Unable to retrieve your location. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg += 'Please allow location access in your browser settings.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg += 'Location information is unavailable. Please check your GPS/Wi-Fi settings.';
                            break;
                        case error.TIMEOUT:
                            errorMsg += 'Location request timed out. Please try again or check your internet connection.';
                            break;
                        default:
                            errorMsg += 'An unknown error occurred. Error code: ' + error.code;
                            break;
                    }
                    
                    showNotification(errorMsg, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 30000,
                    maximumAge: 0
                }
            );
        }
        
        // Set map location
        function setProfileMapLocation(lat, lng) {
            document.getElementById('profileLatitude').value = lat;
            document.getElementById('profileLongitude').value = lng;
            updateProfileLocationDisplay(lat, lng);
            
            if (!profileMap || !profileMapInitialized) {
                const mapContainer = document.getElementById('profileMapContainer');
                const mapPlaceholder = document.getElementById('profileMapPlaceholder');
                if (mapPlaceholder) mapPlaceholder.style.display = 'none';
                if (mapContainer) mapContainer.style.display = 'block';
                
                initProfileMap();
                setTimeout(() => {
                    setProfileMapLocation(lat, lng);
                }, 1000);
                return;
            }
            
            try {
                const customIcon = L.icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                });
                
                if (profileMarker) {
                    profileMap.removeLayer(profileMarker);
                }
                
                profileMap.setView([lat, lng], 16);
                
                profileMarker = L.marker([lat, lng], {
                    icon: customIcon,
                    draggable: true
                }).addTo(profileMap);
                
                const popup = L.popup().setContent('<div style="padding: 8px;"><strong>Your location</strong></div>');
                profileMarker.bindPopup(popup).openPopup();
                
                profileMarker.on('dragend', function(e) {
                    const position = profileMarker.getLatLng();
                    const newLat = position.lat;
                    const newLng = position.lng;
                    document.getElementById('profileLatitude').value = newLat;
                    document.getElementById('profileLongitude').value = newLng;
                    updateProfileLocationDisplay(newLat, newLng);
                });
                
                setTimeout(() => {
                    if (profileMap) {
                        profileMap.invalidateSize();
                    }
                }, 200);
                
                showNotification('Location set successfully!', 'success');
            } catch(error) {
                console.error('Error setting profile map location:', error);
                showNotification('Location coordinates saved. You can manually adjust the marker on the map.', 'warning');
            }
        }
        
        // Update location display
        function updateProfileLocationDisplay(lat, lng) {
            const latDisplay = document.getElementById('profileLatitudeDisplay');
            const lngDisplay = document.getElementById('profileLongitudeDisplay');
            const locationDisplayGroup = document.getElementById('profileLocationDisplayGroup');
            const locationHint = document.getElementById('profileLocationHint');
            
            if (latDisplay && lngDisplay && locationDisplayGroup) {
                latDisplay.value = lat.toFixed(6);
                lngDisplay.value = lng.toFixed(6);
                locationDisplayGroup.style.display = 'block';
                if (locationHint) locationHint.style.display = 'none';
            }
        }
        
        // Clear location
        function clearProfileLocation() {
            if (profileMarker && profileMap) {
                profileMap.removeLayer(profileMarker);
                profileMarker = null;
            }
            
            const latInput = document.getElementById('profileLatitude');
            const lngInput = document.getElementById('profileLongitude');
            if (latInput) latInput.value = '';
            if (lngInput) lngInput.value = '';
            
            const latDisplay = document.getElementById('profileLatitudeDisplay');
            const lngDisplay = document.getElementById('profileLongitudeDisplay');
            const locationDisplayGroup = document.getElementById('profileLocationDisplayGroup');
            const locationHint = document.getElementById('profileLocationHint');
            
            if (latDisplay) latDisplay.value = '';
            if (lngDisplay) lngDisplay.value = '';
            if (locationDisplayGroup) locationDisplayGroup.style.display = 'none';
            if (locationHint) locationHint.style.display = 'block';
        }
        
        // Hide map
        function hideProfileMap() {
            const mapPlaceholder = document.getElementById('profileMapPlaceholder');
            const mapContainer = document.getElementById('profileMapContainer');
            
            if (mapPlaceholder) mapPlaceholder.style.display = 'flex';
            if (mapContainer) {
                mapContainer.style.display = 'none';
                mapContainer.classList.remove('fullscreen');
            }
        }
        
        // Toggle map fullscreen
        function toggleProfileMapFullscreen() {
            const mapContainer = document.getElementById('profileMapContainer');
            const fullscreenIcon = document.getElementById('profileFullscreenIcon');
            
            if (!mapContainer) return;
            
            if (mapContainer.classList.contains('fullscreen')) {
                mapContainer.classList.remove('fullscreen');
                if (fullscreenIcon) {
                    fullscreenIcon.classList.remove('fa-compress');
                    fullscreenIcon.classList.add('fa-expand');
                }
                if (profileMap) {
                    setTimeout(() => {
                        profileMap.invalidateSize();
                    }, 100);
                }
            } else {
                mapContainer.classList.add('fullscreen');
                if (fullscreenIcon) {
                    fullscreenIcon.classList.remove('fa-expand');
                    fullscreenIcon.classList.add('fa-compress');
                }
                if (profileMap) {
                    setTimeout(() => {
                        profileMap.invalidateSize();
                    }, 100);
                }
            }
        }
        
        // Save address
        function saveProfileAddress(event) {
            event.preventDefault();
            
            const form = document.getElementById('profileAddressForm');
            const fields = form.querySelectorAll('input[required], select[required]');
            let isValid = true;
            
            fields.forEach(field => {
                validateProfileField(field);
                if (!field.checkValidity()) {
                    isValid = false;
                }
            });
            
            if (!isValid) {
                const firstError = document.querySelector('#profileAddressForm .form-group.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return;
            }
            
            const region = document.getElementById('profileRegion').value;
            const province = document.getElementById('profileProvince').value;
            const city = document.getElementById('profileCity').value;
            const barangay = document.getElementById('profileBarangay').value;
            
            if (!region || !province || !city || !barangay) {
                showNotification('Please complete all location fields', 'error');
                return;
            }
            
            const latitude = document.getElementById('profileLatitude').value;
            const longitude = document.getElementById('profileLongitude').value;
            
            const address = {
                fullName: document.getElementById('profileFullName').value,
                phoneNumber: document.getElementById('profilePhoneNumber').value,
                region: region,
                province: province,
                city: city,
                barangay: barangay,
                location: `${barangay}, ${city}, ${province}`,
                postalCode: document.getElementById('profilePostalCode').value,
                streetAddress: document.getElementById('profileStreetAddress').value,
                label: document.querySelector('#profileAddressForm .label-btn.active').dataset.label,
                isDefault: true,
                latitude: latitude || null,
                longitude: longitude || null
            };
            
            localStorage.setItem('deliveryAddress', JSON.stringify(address));
            loadProfileAddress();
            closeProfileAddressModal();
            showNotification('Delivery address saved successfully!', 'success');
        }
        
        // Delete address
        function deleteProfileAddress() {
            if (confirm('Are you sure you want to delete this delivery address?')) {
                localStorage.removeItem('deliveryAddress');
                loadProfileAddress();
                showNotification('Delivery address deleted successfully!', 'success');
            }
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            let alertClass = 'alert-success';
            let iconClass = 'fa-check-circle';
            
            if (type === 'error' || type === 'danger') {
                alertClass = 'alert-danger';
                iconClass = 'fa-exclamation-circle';
            } else if (type === 'warning') {
                alertClass = 'alert-warning';
                iconClass = 'fa-exclamation-triangle';
            }
            
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass}`;
            notification.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);';
            notification.innerHTML = `
                <i class="fas ${iconClass} me-2"></i>
                ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>

